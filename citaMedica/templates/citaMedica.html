<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cita Médica</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <h1>Buscar Paciente por Cédula</h1>
    
    <form method="get">
        {{ search_form.as_p }}
        <button type="submit">Buscar</button>
    </form>

    {% if error_message %}
        <p>{{ error_message }}</p>
    {% elif paciente %}
        <h2>Información del Paciente</h2>
        <p>Nombre: {{ paciente.nombre }} {{ paciente.apellido }}</p>
        <p>Cédula: {{ paciente.cedula }}</p>
        <p>Celular: {{ paciente.celular }}</p>

        <form id="cita-form" method="post">
            {% csrf_token %}
            <!-- No se necesita campo de fisioterapeuta -->
            <button type="button" onclick="crearCita()">Agregar Cita Médica</button>
        </form>

        <h2>Citas Médicas</h2>
        <table id="citas-table">
            <thead>
                <tr>
                    <th>Nº</th>
                    <th>Fecha</th>
                    <th>Fisioterapeuta</th>
                    <th>Paciente</th>
                </tr>
            </thead>
            <tbody>
                {% for cita in citas_medicas %}
                <tr>
                    <td>{{ forloop.counter }}</td> <!-- Muestra el índice, empezando por 1 -->
                    <td>{{ cita.fecha }}</td>
                    <td>{{ cita.cedulaFisioterapeuta }}</td>
                    <td>{{ cita.cedulaPaciente }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    <script>
    function crearCita() {
    var formData = $('#cita-form').serialize();  // Obtener datos del formulario

    $.ajax({
        url: '',  // URL de destino
        type: 'POST',
        data: formData,
        success: function(data) {
            if (data.message) {
                alert(data.message);  // Mensaje de éxito
            }

            // Recargar la página para reflejar las nuevas citas
            location.reload();  // Recarga la página
        },
        error: function(xhr, status, error) {
            console.error('Error al crear la cita:', error);
            alert('Hubo un error al crear la cita. Inténtalo de nuevo.');  // Mensaje de error
        }
    });
}

    </script>
</body>
</html>
